--计时器帮助类
local require = require
require "core.Class"
local ObjectManager = require("Manager.ObjectManager")
local CommonUtil = require "util.CommonUtil"
-- local Global = Global
local Timer = class()
-- local

--[[
    @desc: 
    author:{author}
    time:2018-10-14 12:53:35
    --@func:
	--@IsEveryFrame:  是否是每帧都执行
    @return:
]]
function Timer:ctor(parent, func, IsEveryFrame, interval, PrcessCount)
    self.parent = parent
    self.IsEveryFrame = IsEveryFrame
    self.destory = false
    self.func = func
    self.pause = false

    if (IsEveryFrame) then
        self.interval = nil
        self.PrcessCount = nil
    else
        if (PrcessCount == 1) then
            func()
            self.destory = true
            return
        end
        self.interval = interval
        self.PrcessCount = PrcessCount - 1

        self.CalTime = 0
    end

    if (PrcessCount ~= nil) then
        self.CallCount = 0
    end

    if (PrcessCount == 0 or PrcessCount == nil) then
        self.PrcessCount = nil
    end

    func()
end

function Timer:Process()
    if self.destory or self.pause or self.parent.disposed then
        return
    end

    if (self.parent.isUI) and self.parent.IsActive == false then
        return
    end

    if self.IsEveryFrame then
        self.func()
    else
        if self.interval ~= nil and self.interval <= self.CalTime then
            self.func()
            self.CalTime = 0

            if self.PrcessCount ~= nil then
                self.CallCount = self.CallCount + 1
                if self.CallCount >= self.PrcessCount then
                    self.destory = true
                end
            end
        else
            self.CalTime = self.CalTime + ObjectManager.GetSingleObj("TimeManager").deltaTime
        end
    end
end

return Timer
